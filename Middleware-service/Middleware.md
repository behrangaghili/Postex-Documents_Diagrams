
# Middleware

## مقدمه

این سرویس یک سیستم واسط می باشد برای بررسی سلامت واریزی هایی که قرار است انجام شوند. این سرویس یک ورودی دارد که اکسل می باشد و با بررسی این اکسل در خروجی به ما اطلاعاتی می دهد که چه تعدادی از پرداختی های کیف پول معتبر می باشدو خروجی یک فایل اکسل از پرداختی معتبر برای ما ایجاد میکند و چه پرداختی هایی  نامعتبر است و نیاز به تغییر و یا اصلاح دارند با این عمل سلامت واریزی ها مشخص می شود. به عنوان مثال برای پرداخت خدمات نمایندگی در ابتدا شماره سفارش را به عنوان ورودی دریافت می کند و شروع به چک کردن کیف پول میکندو تمامی آیتم های افزایش کیف پول چک میکند مثلا حق نمایندگی پرداخت شده است یا خیر است  اگر سفارش مشکل دار باشد یک لیست از مشکلات بر میگرداند که باید قبل از پرداخت برطرف شوند و یک فایل اصلاحیه ایجاد شود واگر مشکل نداشت باشد فایل جهت پرداخت ایجاد میشود و وارد روند پرداخت و کسرو یا شارژ کیف پول می شود.

## Feature

### نیاز مندی ها

این سرویس یک فعالیت زمانبندی شده می باشد که نیاز هست در یک تایم مشخص   مثل هفته و یا ماه اجرا شود 

در این سرویس ما برای مغایرت گیری از اطلاعات تامین کندهگان از جمله وندور ها و بانک ها استفاده می کنیم 


ورودی وندور ها می تواند به صورت وب سرویسی و یا فایل اکسل در سیستم بارگذاری شود 



### قواعد سرویس

باید کارپوشه ای برای پرداخت داشته باشیم که در ابتدا تایپ پرداخت بررسی شود به عنوان مثال خدمات نمایندگی هستش که باید بررسی شود وضعیت سفارش تکمیل باشد  اگر افزایش مطابق با بانک و یا شرکت های پستی بود و مغایریتی نداشت یک فایل ایجاد شود .و سپس وبسرویس کال شود و لیست پرداختی انجام شود
جمع رکوئیت ها ایجاد شده سمت مدیر برای تایید با یک کد او تی پی زمانی که کد تایید را میزند پرداخت تایید و اجرا شود.

ورودی در این سرویس میشود درخواست ترنزاکشن که یا تایید هست یا خیر
اگر خیر باید نوتیف ارسال شود دلیل عدم تایید را
در صورت تایید دو حالت دارد افزایش سمت بانک هست یا وندور که در این مرحله باید افزایش کنترل شود

---

## Transaction Type

### Deposit

| id | ChargeWalletTypeName    | CanCashout    | RelatedID |
| :-----: | :---: | :---: | :---: |
| 1 | واریز تخفیف حق نمایندگی | 1 | 2 |
| 3 | واریز مبلغ خدمات نمایندگی | 1 |4|
| 6 | واریز مبلغ کمیسیون همکار فروش | 1 | 7 |
| 9 | شارژ کیف پول از طریق پیامک | 0 | null|
| 10 | مبلغ کالای COD | 1 | 13 |
| 11| انتقال اعتبار به مشتری | 0 | null|
| 12 | برگشت اعتبار از طرف مشتری | 0 | null|
| 15 | تسویه مالی | 0 |null|
| 16 | اصلاحیه واریز | 0 |null|
| 18 | اصلاحیه حق مشارکت پستکس در خدمات نمایندگی | 0 |null|
| 20 | واریز مبلغ کالا سفارش امن خریدار | 1 |19|
| 22 | واریز مبلغ کالا سفارش امن فروشنده | 1 |21|

### withdrawal

| id | ChargeWalletTypeName    | CanCashout    | RelatedID |
| :-----: | :---: | :---: | :---: |
| 2 | برگشت تخفیف حق نمایندگی | 0 | null |
| 4 | برگشت مبلغ خدمات نمایندگی | 0 | null |
| 5 | کسر مبلغ سفارش در زمان کنسلی | 0 | null |
| 7 | برگشت مبلغ کمیسیون همکار فروش | 0 | null|
| 8 | برگشت مبلغ کارتن و لفاف | 0 | null|
| 14 | کسر برگشت |  0|null|
| 13 | برگشت مبلغ کالای COD | 0 |null|
| 17 | حق مشارکت پستکس در خدمات نمایندگی | 0 |null|
| 19 | برگشت مبلغ کالا سفارش امن خریدار | 0 |null|
| 21 | برگشت مبلغ کالا سفارش امن فروشنده | 0 |null|

---

## موجودیت

- message پیام
- amount میزان انتقال
- debtorWallet  کیف بدهکار
- CreditorWallet کیف بستانکار
- debtorUser بدهکار 
- creditorUser بستانکار
- vondorsOrdersData اطلاعات سفارش از تامین کننده

---

## متدها

- validationAction()
این متد یک فایل اکسل از مقادیر تایید شده و تایید نشده 

- paymentAction()
  دریافت کد اعتبار سنجی برای مدیر جهت تایید فایل پرداخت از سرویس نوتیفیکشن و ارسال درخواست به سرویس پیمنت